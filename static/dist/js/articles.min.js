!function(){SG.Articles=function(){},SG.Articles.prototype=new SG.Publisher,SG.Articles.prototype.parseContent=function(e){var t=e.text();marked=SG.markSettingNoHightlight();t=marked(t),t=SG.replaceCodeChar(t);e.html(t),emojify.run(e.get(0))},jQuery(document).ready(function(i){i("#submit").on("click",function(e){return e.preventDefault(),!!i(".validate-form").validate().form()&&(0==i("input[type=radio]:checked").val()?(i("#content").val(CKEDITOR.instances.myeditor.getData()),window.localStorage&&localStorage.removeItem("autosaveKey"),i("#txt").val(CKEDITOR.instances.myeditor.document.getBody().getText())):i("#content").val(i("#markdown-content").val()),void(new SG.Articles).publish(this,function(e){"undefined"==typeof cacheKey&&(cacheKey="article"),purgeComposeDraft(uid,cacheKey),setTimeout(function(){e.id?window.location.href="/articles/"+e.id:window.location.href="/articles"},1e3)}))}),i(document).keypress(function(e){!e.ctrlKey||10!=e.which&&13!=e.which||i("#submit").click()}),i(".add-collection").on("click",function(e){e.preventDefault();e=i("#title").data("id");i.getJSON("/subject/mine?article_id="+e,function(e){e.ok&&(n(e.data.subjects),i("body").addClass("modal-open"),i(".add-self").fadeIn())})}),i(".add-self .close").on("click",function(){i("body").removeClass("modal-open"),i(".add-self").fadeOut()});var s="";function n(e){var t,a="";for(t in e){var s=e[t];a+='<li><a href="/subject/'+s.id+'" class="avatar-collection"><img src="'+s.cover+'"></a><div class="collection-info" data-sid="'+s.id+'"><a href="/subject/'+s.id+'" class="collection-name">'+s.name+'</a><div class="meta">'+s.username+" 编</div>",s.had_add?a+=' <span class="status has-add">已收入</span><a class="action-btn remove">移除</a>':a+='<a class="action-btn push">收入</a>',a+="</div></li>"}i("#self-note-list").html(a)}i(".add-self .search-btn").on("click",function(){var a,e,t=i(".add-self .search-input").val();""!=t?(s=i("#self-note-list").html(),i("#self-note-list").html(""),(a=i(".add-self .modal-collections-placeholder")).show(),e=i("#title").data("id"),i.getJSON("/subject/mine?kw="+encodeURIComponent(t)+"&article_id="+e,function(e){var t;a.hide(),e.ok?0==(t=e.data.subjects).length?i("#self-note-list").html('<div class="default">未找到相关专栏</div>'):n(t):i("#self-note-list").html('<div class="default">'+e.msg+"</div>")})):i("#self-note-list").html(s)}),i(".add-self .search-input").on("change",function(){""==i(this).val()&&i("#self-note-list").html(s)}),i(document).keypress(function(e){10!=e.which&&13!=e.which||i(".add-self .search-btn").click()}),i(".add-self").on("click",".action-btn",function(){var t=i(this).parent(),e=t.data("sid"),a=i("#title").data("id"),s=this;i(this).hasClass("push")?i.post("/subject/contribute",{sid:e,article_id:a},function(e){e.ok?i(s).removeClass("push").addClass("remove").before(' <span class="status has-add">已收入</span>').text("移除"):alert(e.error)}):i.post("/subject/remove_contribute",{sid:e,article_id:a},function(e){e.ok?(i(s).removeClass("remove").addClass("push").text("收入"),t.children(".status").remove()):alert(e.error)})})})}.call(this);